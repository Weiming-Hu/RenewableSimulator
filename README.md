# Evergreen: A Renewable Energy Simulator

## Introduction

```
# "`-''-/").___..--''"`-._
#  (`6_ 6  )   `-.  (     ).`-.__.`)   WE ARE ...
#  (_Y_.)'  ._   )  `._ `. ``-..-'    PENN STATE!
#    _ ..`--'_..-_/  /--'_.' ,'
#  (il),-''  (li),'  ((!.-'
# 
# Authors: 
#     Weiming Hu <weiming@psu.edu>
#     Guido Cervone <cervone@psu.edu>
#
# Geoinformatics and Earth Observation Laboratory (http://geolab.psu.edu)
# Department of Geography and Institute for CyberScience
# The Pennsylvania State University
```

`evergreen` is designed for assessing prediction uncertainty for photovoltaic energy production. It builds on top of [Analog Ensemble](https://weiming-hu.github.io/AnalogsEnsemble/) from [GEOlab](geoinf.psu.edu/) and [pvlib](https://pvlib-python.readthedocs.io/en/stable/) from Sandia National Lab.

It is written in Python 3.

## Usage

### Dependency

These packages are used in this project:

- `pandas`
- `netCDF4`
- `pvlib`
- `progress`
- `Cython`
- `yappi` used only for profiling
- `pyinstrument` used only for profiling

### Simulation

You can use the following code to see the available options:

```buildoutcfg
$ python evergreen.py -h
usage: evergreen.py [-h] [--nc NC] [--silent] [--profile]
                    [--profiler PROFILER]

evergreen -- our pursuit of a more sustainable future

optional arguments:
  -h, --help           show this help message and exit
  --nc NC              an NetCDF file with weather analogs generated by PAnEn
                       (https://weiming-hu.github.io/AnalogsEnsemble/
  --silent             No progress information
  --profile            Turn on profiling
  --profiler PROFILER  Either pyinstrument or yappi
```

### Profiling

#### By Function Calls

By default, it uses `pyinstrument` for profiling.

```buildoutcfg
$ python evergreen.py --nc <analogs.nc> --profile
```

Or you can change the profiler.

```buildoutcfg
$ python evergreen.py --nc <analogs.nc> --profile --profiler yappi
```

And then visualize the results with `qcachegrind` on Mac OS or `kcachegrind` on Linux.

#### Line-By-Line Profiling

[line_profiler](https://github.com/pyutils/line_profiler) provides simple-to-use function profiling tools.

First, install the tool.

```buildoutcfg
pip install line_profiler
```

Then, add the following code.

```python
...
import line_profiler

@profile
def run_pv_simulations_with_analogs(nc_file, variable_dict, scenarios, progress=True, early_stopping=False):
...
```

Chnage the function call argument to always enable `early_stopping`.

```python
run_pv_simulations_with_analogs(nc_file, variable_dict, scenarios, progress=not args.silent, early_stopping=True)
```

Then, generate profiling information by running the follwoing code.

```buildoutcfg
# Generate profiling file
kernprof -l evergreen.py

# Generate readable file
python -m line_profiler evergreen.py.lprof > evergreen.py.readable
```

## Feedback

We appreciate collaborations and feedback from users. Please contact maintainer [Weiming Hu](http://weiming.ddns.net) through [weiming@psu.edu](weiming@psu.edu), or create tickets if you have any problems.

Thank you!

